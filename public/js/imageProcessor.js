// Generated by CoffeeScript 1.7.1
(function() {
  var canvas_height, canvas_width, current_element, hammertime, img_height, img_width, initial_focus_top;

  img_width = $(".image").get(0).naturalWidth;

  img_height = $(".image").get(0).naturalHeight;

  canvas_width = $(".image").width();

  canvas_height = $(".image").height();

  $('input[type="checkbox"],[type="radio"]').not('#create-switch').bootstrapSwitch();

  $('.blur-radius').slider();

  $('.tilt-shift-button').click(function() {
    var gradient_center_top, gradient_distance_upper, gradient_height_lower, gradient_height_upper, img, radius;
    img = $('.image').get(0);
    radius = $('.blur-radius').slider('getValue');
    gradient_center_top = ($(".tilt-center").position().top + 25) / canvas_height * img_height;
    gradient_distance_upper = ($(".tilt-center").position().top - $(".tilt-gradient-upper").position().top) / canvas_height * img_height;
    gradient_height_upper = $(".tilt-gradient-upper").height() / canvas_height * img_height;
    gradient_height_lower = $(".tilt-gradient-lower").height() / canvas_height * img_height;
    Caman(img, function() {
      this.myTiltShift(radius, gradient_center_top, gradient_height_upper, gradient_height_lower);
      this.render();
    });
  });

  $('.revert-button').click(function() {
    var img;
    img = $('.image').get(0);
    Caman(img, function() {
      this.revert(true);
    });
  });

  $('.save-button').click(function() {
    var img;
    img = $('.image').get(0);
    Caman(img, function() {
      this.save('png');
    });
  });

  initial_focus_top = canvas_height / 2 - 25;

  $(".tilt-center").css({
    left: canvas_width / 2 - 25,
    top: initial_focus_top
  });

  $(".tilt-gradient-upper").css({
    top: initial_focus_top - 50,
    height: 50
  });

  $(".tilt-gradient-lower").css({
    top: initial_focus_top + 50,
    height: 50
  });

  current_element = void 0;

  hammertime = $("body").hammer();

  hammertime.on("dragstart", ".tilt-center", function(event) {
    current_element = $(".tilt-center");
  });

  $(".tilt-center").on("moved", function(event, pageX, pageY) {
    var y_pos;
    if (pageX > $(".image").offset().left && pageY > $(".image").offset().top && pageX < $(".image").offset().left + canvas_width && pageY < $(".image").offset().top + canvas_height) {
      y_pos = pageY - 25 - $(".image").offset().top;
      current_element.css({
        top: y_pos
      });
      $(".tilt-gradient-upper").css({
        top: y_pos - 50
      });
      $(".tilt-gradient-lower").css({
        top: y_pos + 50
      });
    }
  });

  hammertime.on("dragstart", ".tilt-gradient-upper .tilt-gradient-size .handler", function(event) {
    current_element = $(".tilt-gradient-upper .tilt-gradient-size");
  });

  $(".tilt-gradient-upper .tilt-gradient-size").on("moved", function(event, pageX, pageY) {
    var y1, y2;
    y1 = pageY - $(".image").offset().top;
    y2 = $(".tilt-gradient-upper").position().top + $(".tilt-gradient-upper").height();
    $(".tilt-gradient-upper").css({
      top: y1,
      height: y2 - y1
    });
  });

  hammertime.on("dragstart", ".tilt-gradient-lower .tilt-gradient-size .handler", function(event) {
    current_element = $(".tilt-gradient-lower .tilt-gradient-size");
  });

  $(".tilt-gradient-lower .tilt-gradient-size").on("moved", function(event, pageX, pageY) {
    var y;
    y = pageY - $(".tilt-gradient-lower").offset().top;
    $(".tilt-gradient-lower").css({
      height: y
    });
  });

  hammertime.on("drag", ".tilt-overlay", function(event) {
    if (current_element === void 0) {
      return;
    }
    current_element.trigger("moved", [event.gesture.center.pageX, event.gesture.center.pageY]);
    return event.gesture.preventDefault();
  });

  hammertime.on("dragend", ".tilt-overlay", function(event) {
    current_element = void 0;
  });

}).call(this);
